{% extends 'base.html' %}
{% load static %}

{% block title %}Search Routes - TravelMate{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="relative bg-gradient-to-br from-blue-600 via-purple-700 to-indigo-800 text-white py-20 overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-0 left-0 w-full h-full" style="background-image: url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23ffffff" fill-opacity="0.1"><circle cx="30" cy="30" r="4"/></g></g></svg>');"></div>
    </div>
    
    <!-- Animated Elements -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-white opacity-5 rounded-full animate-pulse"></div>
        <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-white opacity-5 rounded-full animate-pulse delay-1000"></div>
    </div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-route text-3xl"></i>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">
            Find Your Perfect <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">Route</span>
        </h1>
        <p class="text-xl text-gray-200 max-w-3xl mx-auto leading-relaxed">
            Search and compare bus routes across Nepal. Find the best schedules, prices, and operators for your journey.
        </p>
    </div>
</section>

<!-- Search Form -->
<section class="py-12 bg-gray-50 relative">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Search Card -->
        <div class="bg-white rounded-3xl shadow-2xl p-8 -mt-16 relative z-10 border border-gray-100">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Search Bus Routes</h2>
                <p class="text-gray-600">Enter your travel details to find available routes</p>
            </div>
            
            <form id="searchForm" method="GET" action="{% url 'routes:route_results' %}" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Source Location -->
                    <div class="relative">
                        <label for="source" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>From (Source)
                        </label>
                        <div class="relative">
                            <input type="text" id="source" name="source" required
                                   class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 focus:bg-white text-lg"
                                   placeholder="Enter departure city" autocomplete="off" value="{{ request.GET.source|default:'' }}">
                            <div id="sourceSuggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-20 hidden max-h-48 overflow-y-auto">
                                <!-- Suggestions will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Destination Location -->
                    <div class="relative">
                        <label for="destination" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>To (Destination)
                        </label>
                        <div class="relative">
                            <input type="text" id="destination" name="destination" required
                                   class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 focus:bg-white text-lg"
                                   placeholder="Enter destination city" autocomplete="off" value="{{ request.GET.destination|default:'' }}">
                            <div id="destinationSuggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-20 hidden max-h-48 overflow-y-auto">
                                <!-- Suggestions will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Swap Button -->
                <div class="flex justify-center -my-3">
                    <button type="button" id="swapBtn" 
                            class="w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center hover:bg-blue-600 transition-all duration-300 transform hover:scale-110 hover:rotate-180 shadow-lg">
                        <i class="fas fa-exchange-alt"></i>
                    </button>
                </div>
                
                <!-- Travel Date -->
                <div class="mb-6">
                    <label for="travel_date" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-calendar text-green-500 mr-2"></i>Travel Date
                    </label>
                    <input type="date" id="travel_date" name="travel_date" required
                           class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 focus:bg-white text-lg"
                           value="{{ request.GET.travel_date|default:'' }}">
                </div>
                
                <!-- Search Button -->
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-700 text-white py-4 rounded-xl font-semibold text-lg hover:from-blue-700 hover:to-purple-800 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-search mr-2"></i>Search Routes
                </button>
            </form>
        </div>
    </div>
</section>

<!-- Popular Routes -->
<section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Popular Routes</h2>
            <p class="text-xl text-gray-600">Most traveled routes across Nepal</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Route Card 1 -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition-all duration-300 cursor-pointer group" 
                 onclick="selectRoute('Kathmandu', 'Pokhara')">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <span class="font-semibold text-gray-800">Kathmandu</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-400 group-hover:text-blue-500 transition-colors"></i>
                    <div class="flex items-center">
                        <span class="font-semibold text-gray-800">Pokhara</span>
                        <div class="w-3 h-3 bg-red-500 rounded-full ml-2"></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-center">
                        <div class="font-semibold text-gray-800">6-7 hrs</div>
                        <div>Duration</div>
                    </div>
                    <div class="text-center">
                        <div class="font-semibold text-green-600">रू800-1200</div>
                        <div>Price Range</div>
                    </div>

                </div>
            </div>
            
            <!-- Route Card 2 -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition-all duration-300 cursor-pointer group" 
                 onclick="selectRoute('Kathmandu', 'Chitwan')">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <span class="font-semibold text-gray-800">Kathmandu</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-400 group-hover:text-blue-500 transition-colors"></i>
                    <div class="flex items-center">
                        <span class="font-semibold text-gray-800">Chitwan</span>
                        <div class="w-3 h-3 bg-red-500 rounded-full ml-2"></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-center">
                        <div class="font-semibold text-gray-800">4-5 hrs</div>
                        <div>Duration</div>
                    </div>
                    <div class="text-center">
                        <div class="font-semibold text-green-600">रू500-800</div>
                        <div>Price Range</div>
                    </div>
                </div>
            </div>
            
            <!-- Route Card 3 -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition-all duration-300 cursor-pointer group" 
                 onclick="selectRoute('Kathmandu', 'Butwal')">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <span class="font-semibold text-gray-800">Kathmandu</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-400 group-hover:text-blue-500 transition-colors"></i>
                    <div class="flex items-center">
                        <span class="font-semibold text-gray-800">Butwal</span>
                        <div class="w-3 h-3 bg-red-500 rounded-full ml-2"></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-center">
                        <div class="font-semibold text-gray-800">7-8 hrs</div>
                        <div>Duration</div>
                    </div>
                    <div class="text-center">
                        <div class="font-semibold text-green-600">रू900-1300</div>
                        <div>Price Range</div>
                    </div>
                </div>
            </div>
            
            <!-- Route Card 4 -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition-all duration-300 cursor-pointer group" 
                 onclick="selectRoute('Pokhara', 'Chitwan')">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <span class="font-semibold text-gray-800">Pokhara</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-400 group-hover:text-blue-500 transition-colors"></i>
                    <div class="flex items-center">
                        <span class="font-semibold text-gray-800">Chitwan</span>
                        <div class="w-3 h-3 bg-red-500 rounded-full ml-2"></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-center">
                        <div class="font-semibold text-gray-800">3-4 hrs</div>
                        <div>Duration</div>
                    </div>
                    <div class="text-center">
                        <div class="font-semibold text-green-600">रू400-600</div>
                        <div>Price Range</div>
                    </div>
                </div>
            </div>
            
            <!-- Route Card 5 -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition-all duration-300 cursor-pointer group" 
                 onclick="selectRoute('Kathmandu', 'Dhangadhi')">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <span class="font-semibold text-gray-800">Kathmandu</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-400 group-hover:text-blue-500 transition-colors"></i>
                    <div class="flex items-center">
                        <span class="font-semibold text-gray-800">Dhangadhi</span>
                        <div class="w-3 h-3 bg-red-500 rounded-full ml-2"></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-center">
                        <div class="font-semibold text-gray-800">12-14 hrs</div>
                        <div>Duration</div>
                    </div>
                    <div class="text-center">
                        <div class="font-semibold text-green-600">रू1500-2000</div>
                        <div>Price Range</div>
                    </div>
                </div>
            </div>
            
            <!-- Route Card 6 -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition-all duration-300 cursor-pointer group" 
                 onclick="selectRoute('Butwal', 'Nepalgunj')">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <span class="font-semibold text-gray-800">Butwal</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-400 group-hover:text-blue-500 transition-colors"></i>
                    <div class="flex items-center">
                        <span class="font-semibold text-gray-800">Nepalgunj</span>
                        <div class="w-3 h-3 bg-red-500 rounded-full ml-2"></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-center">
                        <div class="font-semibold text-gray-800">5-6 hrs</div>
                        <div>Duration</div>
                    </div>
                    <div class="text-center">
                        <div class="font-semibold text-green-600">रू600-900</div>
                        <div>Price Range</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Why Choose Our Route Search?</h2>
            <p class="text-xl text-gray-600">Advanced features to help you find the perfect journey</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
            <!-- Feature 1 -->
            <div class="text-center group">
                <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-200 transition-colors">
                    <i class="fas fa-search text-2xl text-blue-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Smart Search</h3>
                <p class="text-gray-600">Intelligent autocomplete and suggestions for faster route discovery.</p>
            </div>
            
            <!-- Feature 2 -->
            <div class="text-center group">
                <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-green-200 transition-colors">
                    <i class="fas fa-clock text-2xl text-green-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Real-time Updates</h3>
                <p class="text-gray-600">Live schedule updates and availability information for accurate planning.</p>
            </div>
            
            <!-- Feature 3 -->
            <div class="text-center group">
                <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-purple-200 transition-colors">
                    <i class="fas fa-filter text-2xl text-purple-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Advanced Filters</h3>
                <p class="text-gray-600">Filter by price, duration, bus type, and amenities to find your ideal trip.</p>
            </div>
            
            <!-- Feature 4 -->
            <div class="text-center group">
                <div class="w-16 h-16 bg-orange-100 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-orange-200 transition-colors">
                    <i class="fas fa-chart-line text-2xl text-orange-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Price Comparison</h3>
                <p class="text-gray-600">Compare prices across different operators to get the best deals.</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-16 bg-gradient-to-r from-blue-600 via-purple-700 to-blue-800 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Ready to Start Your Journey?</h2>
        <p class="text-xl text-blue-100 mb-8 max-w-3xl mx-auto">
            Search from hundreds of routes and thousands of buses across Nepal. Find the perfect trip for your travel needs.
        </p>
        <a href="#searchForm" class="bg-white text-blue-600 px-8 py-4 rounded-xl font-semibold hover:bg-gray-100 transition-colors transform hover:scale-105 shadow-lg">
            <i class="fas fa-search mr-2"></i>Search Routes Now
        </a>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('travel_date').setAttribute('min', today);
        document.getElementById('travel_date').value = today;
        
        // Nepali cities for autocomplete
        const nepaliCities = [
            'Kathmandu', 'Pokhara', 'Lalitpur', 'Bhaktapur', 'Biratnagar', 'Birgunj',
            'Dharan', 'Bharatpur', 'Janakpur', 'Butwal', 'Dhangadhi', 'Mahendranagar',
            'Hetauda', 'Itahari', 'Kalaiya', 'Gorkha', 'Baglung', 'Tansen',
            'Dang', 'Nepalgunj', 'Surkhet', 'Tulsipur', 'Ghorahi', 'Chitwan',
            'Lumbini', 'Kapilvastu', 'Nawalparasi', 'Rupandehi', 'Palpa', 'Syangja',
            'Kaski', 'Lamjung', 'Tanahu', 'Gorkha', 'Manang', 'Mustang',
            'Myagdi', 'Parbat', 'Baglung', 'Gulmi', 'Arghakhanchi', 'Pyuthan',
            'Rolpa', 'Rukum', 'Salyan', 'Dolpa', 'Humla', 'Jumla', 'Kalikot',
            'Mugu', 'Surkhet', 'Dailekh', 'Jajarkot', 'Dolakha', 'Ramechhap',
            'Sindhuli', 'Kavrepalanchok', 'Sindhupalchok', 'Nuwakot', 'Rasuwa',
            'Dhading', 'Makwanpur', 'Chitwan', 'Parsa', 'Bara', 'Rautahat',
            'Sarlahi', 'Mahottari', 'Dhanusa', 'Siraha', 'Saptari', 'Sunsari',
            'Morang', 'Jhapa', 'Ilam', 'Panchthar', 'Taplejung', 'Sankhuwasabha',
            'Bhojpur', 'Solukhumbu', 'Okhaldhunga', 'Khotang', 'Udayapur'
        ];
        
        function showSuggestions(input, suggestionsDiv) {
            const value = input.value.toLowerCase();
            if (value.length < 2) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            const matches = nepaliCities.filter(city => 
                city.toLowerCase().includes(value)
            ).slice(0, 5);
            
            if (matches.length > 0) {
                const html = matches.map(city => 
                    `<div class="suggestion-item px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0" data-city="${city}">${city}</div>`
                ).join('');
                suggestionsDiv.innerHTML = html;
                suggestionsDiv.classList.remove('hidden');
            } else {
                suggestionsDiv.classList.add('hidden');
            }
        }
        
        // Source input suggestions
        const sourceInput = document.getElementById('source');
        const sourceSuggestions = document.getElementById('sourceSuggestions');
        
        sourceInput.addEventListener('input', function() {
            showSuggestions(this, sourceSuggestions);
        });
        
        // Destination input suggestions
        const destinationInput = document.getElementById('destination');
        const destinationSuggestions = document.getElementById('destinationSuggestions');
        
        destinationInput.addEventListener('input', function() {
            showSuggestions(this, destinationSuggestions);
        });
        
        // Handle suggestion clicks
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('suggestion-item')) {
                const city = e.target.getAttribute('data-city');
                const input = e.target.closest('.relative').querySelector('input');
                input.value = city;
                e.target.parentElement.classList.add('hidden');
            }
        });
        
        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.relative')) {
                document.querySelectorAll('[id$="Suggestions"]').forEach(div => {
                    div.classList.add('hidden');
                });
            }
        });
        
        // Swap locations
        document.getElementById('swapBtn').addEventListener('click', function() {
            const source = sourceInput.value;
            const destination = destinationInput.value;
            
            sourceInput.value = destination;
            destinationInput.value = source;
            
            // Add rotation animation
            this.style.transform = 'rotate(180deg)';
            setTimeout(() => {
                this.style.transform = 'rotate(0deg)';
            }, 300);
        });
        
        // Form validation
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            const source = sourceInput.value.trim();
            const destination = destinationInput.value.trim();
            
            if (source === destination) {
                e.preventDefault();
                alert('Source and destination cannot be the same!');
                return false;
            }
            
            // Add loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Searching Routes...';
            submitBtn.disabled = true;
        });
        
        // Auto-focus on source input
        sourceInput.focus();
        
        // Smooth scroll for CTA button
        document.querySelector('a[href="#searchForm"]').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('#searchForm').scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        });
    });
    
    // Function to select route from popular routes
    function selectRoute(source, destination) {
        document.getElementById('source').value = source;
        document.getElementById('destination').value = destination;
        
        // Smooth scroll to search form
        document.querySelector('#searchForm').scrollIntoView({
            behavior: 'smooth',
            block: 'center'
        });
        
        // Focus on travel date
        setTimeout(() => {
            document.getElementById('travel_date').focus();
        }, 500);
    }
</script>
{% endblock %}