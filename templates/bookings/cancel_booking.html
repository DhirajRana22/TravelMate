{% extends 'base.html' %} {% load static %} {% block title %}Cancel Booking -
TravelMate{% endblock %} {% block content %}
<!-- Header -->
<section
  class="bg-gradient-to-r from-red-600 to-red-700 text-white py-16 -mt-6"
>
  <div class="container mx-auto px-4">
    <div class="text-center">
      <div
        class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4"
      >
        <i class="fas fa-exclamation-triangle text-3xl"></i>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold mb-2">Cancel Booking</h1>
      <p class="text-xl opacity-90">
        Request cancellation for your bus reservation
      </p>
    </div>
  </div>
</section>

<!-- Cancellation Form -->
<section class="py-12 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="max-w-4xl mx-auto">
      <!-- Warning Section -->
      <div
        class="bg-red-50 border border-red-200 rounded-xl p-8 mb-8 text-center"
      >
        <div
          class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
        </div>
        <h3 class="text-xl font-semibold text-red-800 mb-2">
          Important Notice
        </h3>
        <p class="text-red-700 mb-4">
          Cancelling your booking may result in cancellation charges as per our
          policy. Please review the details below before proceeding.
        </p>
        <div class="bg-white rounded-lg p-4 inline-block">
          <p class="text-sm text-red-600 font-medium">
            Cancellation charges may apply based on the time remaining until
            departure
          </p>
        </div>
      </div>

      <!-- Booking Summary -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
          <h3 class="text-xl font-semibold text-gray-800">
            <i class="fas fa-ticket-alt mr-2 text-blue-500"></i>Booking Summary
          </h3>
        </div>

        <div class="p-6">
          <!-- Journey Information -->
          <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <div class="flex items-center justify-center mb-4">
              <div class="text-center">
                <div class="text-xl font-bold text-gray-800">
                  {{ booking.route.source }}
                </div>
                <div class="text-sm text-gray-500">
                  {{ booking.departure_time|time:"g:i A" }}
                </div>
              </div>
              <div class="mx-6">
                <i class="fas fa-arrow-right text-blue-500 text-2xl"></i>
              </div>
              <div class="text-center">
                <div class="text-xl font-bold text-gray-800">
                  {{ booking.route.destination }}
                </div>
                <div class="text-sm text-gray-500">
                  {{ booking.arrival_time|time:"g:i A" }}
                </div>
              </div>
            </div>
          </div>

          <!-- Booking Details Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white p-4 rounded-lg border border-gray-200">
              <div class="text-xs text-gray-500 mb-1">Booking ID</div>
              <div class="font-semibold text-gray-800">
                {{ booking.booking_id }}
              </div>
            </div>
            <div class="bg-white p-4 rounded-lg border border-gray-200">
              <div class="text-xs text-gray-500 mb-1">Travel Date</div>
              <div class="font-semibold text-gray-800">
                {{ booking.travel_date|date:"M d, Y" }}
              </div>
            </div>
            <div class="bg-white p-4 rounded-lg border border-gray-200">
              <div class="text-xs text-gray-500 mb-1">Seats</div>
              <div class="font-semibold text-gray-800">
                {{ booking.seat_numbers }}
              </div>
            </div>
            <div class="bg-white p-4 rounded-lg border border-gray-200">
              <div class="text-xs text-gray-500 mb-1">Passengers</div>
              <div class="font-semibold text-gray-800">
                {{ booking.passenger_count }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Cancellation Policy -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
          <h3 class="text-xl font-semibold text-gray-800">
            <i class="fas fa-file-contract mr-2 text-purple-500"></i
            >Cancellation Policy
          </h3>
        </div>

        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h4 class="font-semibold text-gray-800 mb-3">
                Cancellation Charges
              </h4>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">More than 24 hours:</span>
                  <span class="font-medium">10% of fare</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">12-24 hours:</span>
                  <span class="font-medium">25% of fare</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">6-12 hours:</span>
                  <span class="font-medium">50% of fare</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Less than 6 hours:</span>
                  <span class="font-medium text-red-600">No refund</span>
                </div>
              </div>
            </div>

            <div>
              <h4 class="font-semibold text-gray-800 mb-3">
                Your Cancellation
              </h4>
              <div class="bg-blue-50 p-4 rounded-lg">
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span class="text-gray-600">Original Fare:</span>
                    <span class="font-medium">रू{{ booking.total_fare }}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Cancellation Charge:</span>
                    <span class="font-medium text-red-600"
                      >रू{{ cancellation_charge|default:0 }}</span
                    >
                  </div>
                  <hr class="border-gray-300" />
                  <div class="flex justify-between text-lg">
                    <span class="font-semibold text-gray-800"
                      >Refund Amount:</span
                    >
                    <span class="font-bold text-green-600"
                      >रू{{ refund_amount|default:0 }}</span
                    >
                  </div>
                </div>
              </div>
              <p class="text-xs text-gray-500 mt-2">
                Refund will be processed within 5-7 business days
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Cancellation Form -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
          <h3 class="text-xl font-semibold text-gray-800">
            <i class="fas fa-edit mr-2 text-red-500"></i>Cancellation Request
          </h3>
        </div>

        <div class="p-6">
          <form method="post" id="cancellationForm" class="space-y-6">
            {% csrf_token %}

            <!-- Cancellation Reason -->
            <div>
              <label
                for="reason"
                class="block text-sm font-medium text-gray-700 mb-2"
              >
                Reason for Cancellation <span class="text-red-500">*</span>
              </label>
              <select
                id="reason"
                name="reason"
                class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200"
                required
              >
                <option value="">Select a reason</option>
                <option value="change_of_plans">Change of Plans</option>
                <option value="emergency">Emergency</option>
                <option value="schedule_conflict">Schedule Conflict</option>
                <option value="health_issues">Health Issues</option>
                <option value="weather_conditions">Weather Conditions</option>
                <option value="other">Other</option>
              </select>
              <div
                id="error-reason"
                class="text-red-600 text-sm mt-1 hidden"
              ></div>
            </div>

            <!-- Additional Comments -->
            <div>
              <label
                for="comments"
                class="block text-sm font-medium text-gray-700 mb-2"
              >
                Additional Comments (Optional)
              </label>
              <textarea
                id="comments"
                name="comments"
                rows="4"
                class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200 resize-none"
                placeholder="Please provide any additional details about your cancellation..."
              ></textarea>
              <p class="text-xs text-gray-500 mt-1">
                This information helps us improve our services
              </p>
            </div>

            <!-- Refund Method -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-3">
                Preferred Refund Method
              </label>
              <div class="space-y-3">
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="refund_method"
                    value="original_payment"
                    class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300"
                    checked
                  />
                  <span class="ml-2 text-sm text-gray-700">
                    <span class="font-medium">Original Payment Method</span>
                    <span class="text-gray-500 block"
                      >Refund to the original payment source</span
                    >
                  </span>
                </label>
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="refund_method"
                    value="bank_transfer"
                    class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300"
                  />
                  <span class="ml-2 text-sm text-gray-700">
                    <span class="font-medium">Bank Transfer</span>
                    <span class="text-gray-500 block"
                      >Direct transfer to your bank account</span
                    >
                  </span>
                </label>
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="refund_method"
                    value="wallet"
                    class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300"
                  />
                  <span class="ml-2 text-sm text-gray-700">
                    <span class="font-medium">TravelMate Wallet</span>
                    <span class="text-gray-500 block"
                      >Credit to your TravelMate wallet for future
                      bookings</span
                    >
                  </span>
                </label>
              </div>
            </div>

            <!-- Confirmation Checkbox -->
            <div class="border border-gray-200 rounded-lg p-4">
              <div class="flex items-start">
                <input
                  type="checkbox"
                  id="confirm"
                  name="confirm"
                  class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded mt-1"
                  required
                />
                <label for="confirm" class="ml-2 block text-sm text-gray-700">
                  I understand and agree to the cancellation policy. I confirm
                  that:
                  <ul class="mt-2 space-y-1 text-xs text-gray-600 ml-4">
                    <li>
                      • Cancellation charges will be deducted as per the policy
                    </li>
                    <li>• Refund will be processed within 5-7 business days</li>
                    <li>• This action cannot be undone once confirmed</li>
                    <li>
                      • I have read and understood the terms and conditions
                    </li>
                  </ul>
                </label>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row justify-between gap-4 pt-4">
              <a
                href="{% url 'bookings:booking_detail' booking.booking_id %}"
                class="bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 transition-colors text-center font-medium"
              >
                <i class="fas fa-arrow-left mr-2"></i>Back to Booking
              </a>

              <button
                type="submit"
                id="cancelBtn"
                disabled
                class="bg-red-500 text-white px-8 py-3 rounded-lg hover:bg-red-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium"
              >
                <i class="fas fa-times mr-2"></i>Cancel Booking
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Support Information -->
      <div class="bg-blue-50 rounded-xl p-6 mt-8 border border-blue-200">
        <h4 class="text-lg font-semibold text-blue-800 mb-3">
          <i class="fas fa-headset mr-2"></i>Need Help?
        </h4>
        <p class="text-sm text-blue-700 mb-4">
          If you have any questions about the cancellation process or need
          assistance, our customer support team is here to help.
        </p>
        <div class="flex flex-col sm:flex-row gap-4">
          <a
            href="tel:+977-1-4567890"
            class="text-blue-600 hover:text-blue-700 font-medium text-sm"
          >
            <i class="fas fa-phone mr-2"></i>+977-1-4567890
          </a>
          <a
            href="mailto:support@travelmate.com"
            class="text-blue-600 hover:text-blue-700 font-medium text-sm"
          >
            <i class="fas fa-envelope mr-2"></i>support@travelmate.com
          </a>
          <a
            href="#"
            class="text-blue-600 hover:text-blue-700 font-medium text-sm"
          >
            <i class="fas fa-comments mr-2"></i>Live Chat
          </a>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("cancellationForm");
    const reasonSelect = document.getElementById("reason");
    const confirmCheckbox = document.getElementById("confirm");
    const cancelBtn = document.getElementById("cancelBtn");
    const commentsTextarea = document.getElementById("comments");

    // Update cancel button state
    function updateCancelButton() {
      const isReasonSelected = reasonSelect.value !== "";
      const isConfirmed = confirmCheckbox.checked;

      cancelBtn.disabled = !(isReasonSelected && isConfirmed);

      if (isReasonSelected && isConfirmed) {
        cancelBtn.classList.remove("bg-gray-300", "cursor-not-allowed");
        cancelBtn.classList.add("bg-red-500", "hover:bg-red-600");
      } else {
        cancelBtn.classList.add("bg-gray-300", "cursor-not-allowed");
        cancelBtn.classList.remove("bg-red-500", "hover:bg-red-600");
      }
    }

    // Event listeners
    confirmCheckbox.addEventListener("change", updateCancelButton);
    reasonSelect.addEventListener("change", updateCancelButton);

    // Auto-resize textarea
    if (commentsTextarea) {
      commentsTextarea.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
      });
    }

    // Form validation
    function validateForm() {
      let isValid = true;

      // Clear previous errors
      document.querySelectorAll(".text-red-600").forEach((error) => {
        if (error.id.startsWith("error-")) {
          error.textContent = "";
          error.classList.add("hidden");
        }
      });

      document.querySelectorAll("input, select").forEach((field) => {
        field.classList.remove("border-red-500", "ring-red-500");
        field.classList.add("border-gray-300");
      });

      // Validate reason selection
      if (!reasonSelect.value) {
        showError(reasonSelect, "Please select a reason for cancellation");
        isValid = false;
      }

      // Validate confirmation
      if (!confirmCheckbox.checked) {
        alert("Please confirm that you understand the cancellation policy.");
        isValid = false;
      }

      return isValid;
    }

    function showError(field, message) {
      field.classList.add("border-red-500", "ring-red-500");
      field.classList.remove("border-gray-300");

      const errorElement = document.getElementById("error-reason");
      if (errorElement) {
        errorElement.textContent = message;
        errorElement.classList.remove("hidden");
      }
    }

    // Form submission with confirmation
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      if (!validateForm()) {
        return;
      }

      // Double confirmation
      const confirmMessage =
        `Are you sure you want to cancel this booking?\n\n` +
        `Booking ID: {{ booking.booking_id }}\n` +
        `Refund Amount: रू{{ refund_amount|floatformat:2 }}\n\n` +
        `This action cannot be undone.`;

      if (confirm(confirmMessage)) {
        // Show loading state
        cancelBtn.disabled = true;
        cancelBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin mr-2"></i>Cancelling...';

        // Submit form
        this.submit();
      }
    });

    // Initialize button state
    updateCancelButton();

    // Add smooth animations to cards
    const cards = document.querySelectorAll(".bg-white");
    cards.forEach((card, index) => {
      card.style.opacity = "0";
      card.style.transform = "translateY(20px)";

      setTimeout(() => {
        card.style.transition = "all 0.5s ease";
        card.style.opacity = "1";
        card.style.transform = "translateY(0)";
      }, index * 200);
    });
  });
</script>
{% endblock %}
